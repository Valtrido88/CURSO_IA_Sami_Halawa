<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Preguntas OPE - Microbiología y Parasitología</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Estilos para la animadora */
        .cheerleader {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        .cheerleader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .cheerleader-figure {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 24px;
            animation: dance 3s infinite ease-in-out;
        }

        .head {
            font-size: 32px;
            animation: nod 1.5s infinite;
        }

        .body {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .arm {
            font-size: 20px;
            animation: wave 1s infinite alternate;
        }

        .torso {
            font-size: 28px;
        }

        .legs {
            display: flex;
            gap: 5px;
            font-size: 20px;
        }

        .pompoms {
            position: relative;
            margin-top: -10px;
        }

        .pompom {
            display: inline-block;
            font-size: 20px;
            animation: shake 0.5s infinite;
        }

        .pompom.left {
            margin-right: 40px;
            animation-delay: 0.2s;
        }

        .cheer-bubble {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(196, 69, 105, 0.3);
            max-width: 280px;
            text-align: center;
        }

        .cheer-bubble::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #c44569;
        }

        .cheer-text {
            font-weight: bold;
            font-size: 14px;
            animation: glow 2s infinite alternate;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes dance {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        @keyframes nod {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes wave {
            0% { transform: rotate(-15deg); }
            100% { transform: rotate(15deg); }
        }

        @keyframes shake {
            0%, 100% { transform: rotate(-10deg) scale(1); }
            25% { transform: rotate(10deg) scale(1.1); }
            50% { transform: rotate(-5deg) scale(1); }
            75% { transform: rotate(5deg) scale(1.1); }
        }

        @keyframes glow {
            0% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            100% { text-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 25px rgba(255, 107, 157, 0.6); }
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mode-btn {
            padding: 8px 16px;
            border: 2px solid #4facfe;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #4facfe;
            color: white;
        }

        .filter-section {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .filter-btn.active {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }

        .main-content {
            padding: 30px;
        }

        .start-screen {
            text-align: center;
            padding: 40px;
        }

        .start-screen h2 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .start-screen p {
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #666;
        }

        .start-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
        }

        .question-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #4facfe;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #4facfe;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .outdated-badge {
            background: #ff5722;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .difficulty-badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }

        .difficulty-facil { background: #d4edda; color: #155724; }
        .difficulty-medio { background: #fff3cd; color: #856404; }
        .difficulty-dificil { background: #f8d7da; color: #721c24; }

        .question-category {
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #666;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #333;
        }

        .options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #4facfe;
            background: #4facfe;
            color: white;
        }

        .option.correct {
            border-color: #28a745;
            background: #28a745;
            color: white;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
        }

        .option-letter {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #6c757d;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .explanation {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #4facfe;
        }

        .explanation h4 {
            color: #4facfe;
            margin-bottom: 10px;
        }

        .explanation p {
            line-height: 1.6;
            color: #666;
            margin-bottom: 10px;
        }

        .explanation a {
            color: #4facfe;
            text-decoration: none;
            font-weight: bold;
        }

        .explanation a:hover {
            text-decoration: underline;
        }

        .outdated-warning {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            border-left: 4px solid #ff5722;
        }

        .outdated-warning h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .update-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .current-info {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .current-info p {
            margin: 5px 0;
            line-height: 1.4;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2196f3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .bookmark-btn {
            background: #ffc107;
            color: #212529;
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .bookmark-btn:hover {
            background: #e0a800;
        }

        .bookmark-btn.bookmarked {
            background: #dc3545;
            color: white;
        }

        .results {
            text-align: center;
            padding: 40px;
        }

        .results h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #4facfe;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            color: white;
            font-size: 2em;
            font-weight: bold;
        }

        .category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .category-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .category-stat h4 {
            color: #4facfe;
            margin-bottom: 10px;
        }

        .category-progress {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .category-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #4facfe;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .stats {
                justify-content: center;
            }

            .question-header {
                flex-direction: column;
                gap: 10px;
            }

            .navigation {
                flex-direction: column;
                gap: 15px;
            }

            .category-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧬 Banco de Preguntas OPE</h1>
            <p>Microbiología y Parasitología - 25 Preguntas Actualizadas</p>
            
            <!-- Animadora motivacional para Kike -->
            <div class="cheerleader" id="cheerleader">
                <div class="cheerleader-container">
                    <div class="cheerleader-figure">
                        <div class="head">😊</div>
                        <div class="body">
                            <div class="arm left">💪</div>
                            <div class="torso">👕</div>
                            <div class="arm right">🎀</div>
                        </div>
                        <div class="legs">
                            <div class="leg left">🦵</div>
                            <div class="leg right">🦵</div>
                        </div>
                        <div class="pompoms">
                            <span class="pompom left">🎊</span>
                            <span class="pompom right">🎊</span>
                        </div>
                    </div>
                    <div class="cheer-bubble">
                        <div class="cheer-text" id="cheer-text">¡Vamos Kike! 🔥 ¡Tú puedes con toda la micro! 💪✨</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="mode-selector">
                <span>Modo:</span>
                <button class="mode-btn active" data-mode="immediate">Corrección Inmediata</button>
                <button class="mode-btn" data-mode="final">Corrección Final</button>
                <button class="mode-btn" data-mode="study">Modo Estudio</button>
            </div>
            
            <div class="filter-section">
                <span>Filtros:</span>
                <button class="filter-btn active" data-category="all">Todas</button>
                <button class="filter-btn" data-category="Bacteriología">Bacterio</button>
                <button class="filter-btn" data-category="Virología">Viro</button>
                <button class="filter-btn" data-category="Micología">Mico</button>
                <button class="filter-btn" data-category="Parasitología">Parasito</button>
                <button class="filter-btn" data-category="Resistencias">Resist</button>
            </div>
            
            <div class="timer" id="timer">00:00</div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>
            
            <div class="stats">
                <span>Pregunta: <span id="current-question">1</span>/<span id="total-questions">25</span></span>
                <span>Correctas: <span id="correct-count">0</span></span>
                <span>Incorrectas: <span id="incorrect-count">0</span></span>
                <span style="font-size: 12px; color: #ff5722;">⚠️ = Info. Desactualizada</span>
            </div>
        </div>

        <div class="main-content">
            <!-- Pantalla de inicio -->
            <div id="start-screen" class="start-screen">
                <h2>🎯 ¡Listo para comenzar!</h2>
                <p>Este banco contiene 25 preguntas de alta calidad sobre Microbiología y Parasitología.<br>
                   Incluye información actualizada a 2024 y explicaciones detalladas.</p>
                <button class="start-btn" onclick="startQuiz()">
                    🚀 Comenzar Test
                </button>
                <div style="margin-top: 30px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <h3 style="color: #4facfe; margin-bottom: 15px;">💡 Instrucciones:</h3>
                    <ul style="color: #666; line-height: 1.6;">
                        <li><strong>Modos:</strong> Elige entre corrección inmediata, final o modo estudio</li>
                        <li><strong>Filtros:</strong> Estudia por categorías específicas</li>
                        <li><strong>Marcadores:</strong> Marca preguntas para repasar después</li>
                        <li><strong>Atajos:</strong> Usa A,B,C,D para responder rápido</li>
                        <li><strong>Actualización:</strong> Las preguntas marcadas con ⚠️ incluyen info actualizada</li>
                    </ul>
                </div>
            </div>

            <!-- Contenedor del quiz -->
            <div id="quiz-container" class="hidden">
                <!-- Las preguntas se cargarán aquí -->
            </div>

            <!-- Resultados finales -->
            <div id="results-container" class="results hidden">
                <h2>¡Test Completado!</h2>
                <div class="score-circle">
                    <span id="final-score">0%</span>
                </div>
                <p>Has completado el banco de preguntas</p>
                <div class="category-stats" id="category-stats">
                    <!-- Estadísticas por categoría -->
                </div>
                <div class="navigation">
                    <button class="nav-btn btn-primary" onclick="restartQuiz()">
                        🔄 Reiniciar Test
                    </button>
                    <button class="nav-btn btn-secondary" onclick="reviewIncorrect()">
                        📚 Repasar Incorrectas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Banco de preguntas completo
        const questions = [
            {
                id: 1,
                category: "Bacteriología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes microorganismos presenta resistencia intrínseca a vancomicina?",
                options: [
                    "Enterococcus gallinarum",
                    "Enterococcus faecium", 
                    "Aerococcus viridans",
                    "Bacillus spp."
                ],
                correct: 0,
                explanation: "Enterococcus gallinarum presenta resistencia intrínseca a vancomicina tipo VanC, que es de bajo nivel. Esta resistencia es cromosómica y no transferible, a diferencia de la resistencia adquirida VanA y VanB.",
                outdated: false
            },
            {
                id: 2,
                category: "Virología",
                difficulty: "dificil",
                question: "¿Cuál de los siguientes virus pertenece a la familia Bunyaviridae?",
                options: [
                    "Virus Norwalk",
                    "Virus Ébola", 
                    "Virus de la fiebre hemorrágica Crimea-Congo",
                    "Virus de la fiebre amarilla"
                ],
                correct: 2,
                explanation: "El virus de la fiebre hemorrágica Crimea-Congo pertenece a la familia Bunyaviridae (ahora Nairoviridae según clasificación actual).",
                outdated: true,
                updateInfo: {
                    reason: "📋 CLASIFICACIÓN ACTUALIZADA: La familia Bunyaviridae fue reorganizada en 2016 por el ICTV.",
                    currentInfo: "Clasificación actual (2024): Familia Nairoviridae, Género Orthonairovirus. La antigua familia Bunyaviridae se dividió en múltiples familias."
                }
            },
            {
                id: 3,
                category: "Micología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes hongos produce hifas anchas no septadas?",
                options: [
                    "Aspergillus terreus",
                    "Penicillium marneffei",
                    "Saksenaea vasiformis", 
                    "Scopulariopsis brevicaulis"
                ],
                correct: 2,
                explanation: "Saksenaea vasiformis pertenece al orden Mucorales y produce hifas anchas (10-20 μm) no septadas, características de los mucormicetos. Es un hongo filamentoso que puede causar mucormicosis.",
                outdated: false
            },
            {
                id: 4,
                category: "Parasitología",
                difficulty: "facil",
                question: "¿Cuál de las siguientes filarias es una causa importante de ceguera?",
                options: [
                    "Wuchereria bancrofti",
                    "Brugia malayi",
                    "Onchocerca volvulus",
                    "Loa loa"
                ],
                correct: 2,
                explanation: "Onchocerca volvulus causa oncocercosis o 'ceguera de los ríos'. Las microfilarias migran al ojo causando queratitis, coriorretinitis y ceguera. Es endémica en África y algunas áreas de América.",
                outdated: false
            },
            {
                id: 5,
                category: "Resistencias",
                difficulty: "dificil",
                question: "¿Cuál de los siguientes mecanismos NO se asocia con resistencia a Linezolid?",
                options: [
                    "Presencia del gen cfr",
                    "Presencia del gen mef",
                    "Modificaciones de la subunidad 23S del ARNr",
                    "Modificaciones en las proteínas ribosomales L3 y/o L4"
                ],
                correct: 1,
                explanation: "El gen mef codifica una bomba de eflujo que confiere resistencia a macrólidos, no a linezolid. Los otros mecanismos sí se asocian con resistencia a linezolid al afectar la subunidad 50S del ribosoma.",
                outdated: true,
                updateInfo: {
                    reason: "🔬 NUEVOS MECANISMOS DESCRITOS: Se han identificado nuevos mecanismos de resistencia a linezolid desde 2018.",
                    currentInfo: "Mecanismos actuales (2024): cfr y variantes (cfr(B), cfr(C), cfr(D)), genes optrA y poxtA (nuevos genes transferibles), mutaciones en rplC, rplD, rplV."
                }
            },
            {
                id: 6,
                category: "Bacteriología",
                difficulty: "facil",
                question: "¿A qué se debe la resistencia de Staphylococcus aureus a la meticilina?",
                options: [
                    "A la presencia de penicilinasa",
                    "A la presencia del gen mecA",
                    "A cambios en la síntesis de la pared celular",
                    "A la presencia del gen vanA"
                ],
                correct: 1,
                explanation: "La resistencia a meticilina se debe al gen mecA que codifica la PBP2a (proteína de unión a penicilina 2a), que tiene baja afinidad por los β-lactámicos. Este gen está localizado en el cassette cromosómico SCCmec.",
                outdated: false
            },
            {
                id: 7,
                category: "Virología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes virus NO produce fiebre hemorrágica?",
                options: [
                    "Virus Ébola",
                    "Virus chikungunya",
                    "Virus de la fiebre de Crimea-Congo",
                    "Virus de la fiebre del valle del Rift"
                ],
                correct: 1,
                explanation: "El virus chikungunya causa fiebre, exantema y artralgias intensas, pero no produce fiebre hemorrágica. Los otros virus mencionados son agentes conocidos de fiebres hemorrágicas virales.",
                outdated: false
            },
            {
                id: 8,
                category: "Micología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes hongos es dematiáceo?",
                options: [
                    "Cladophialophora bantiana",
                    "Microsporum canis",
                    "Fusarium solani",
                    "Lichtheimia corymbifera"
                ],
                correct: 0,
                explanation: "Cladophialophora bantiana es un hongo dematiáceo (pigmentado) que puede causar cromoblastomicosis y feohifomicosis. Los hongos dematiáceos contienen melanina en su pared celular.",
                outdated: false
            },
            {
                id: 9,
                category: "Parasitología",
                difficulty: "facil",
                question: "El hospedador definitivo de Echinococcus granulosus es:",
                options: [
                    "Vaca",
                    "Hombre",
                    "Oveja",
                    "Perro"
                ],
                correct: 3,
                explanation: "El perro es el hospedador definitivo de Echinococcus granulosus. Los huevos se eliminan en las heces del perro, y los hospedadores intermediarios (oveja, vaca, hombre) desarrollan los quistes hidatídicos.",
                outdated: false
            },
            {
                id: 10,
                category: "Bacteriología",
                difficulty: "medio",
                question: "Listeria monocytogenes es, de forma intrínseca, resistente a:",
                options: [
                    "Ceftriaxona",
                    "Ampicilina",
                    "Penicilina G",
                    "Trimetoprim-sulfametoxazol"
                ],
                correct: 0,
                explanation: "Listeria monocytogenes es intrínsecamente resistente a las cefalosporinas, incluyendo ceftriaxona. Es sensible a ampicilina y penicilina G, que son los tratamientos de elección.",
                outdated: false
            },
            {
                id: 11,
                category: "Virología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes virus es causante de un síndrome mononucleósico sin anticuerpos heterófilos?",
                options: [
                    "Virus de Epstein Barr",
                    "Citomegalovirus",
                    "Virus del herpes simple",
                    "Herpesvirus humano tipo 8"
                ],
                correct: 1,
                explanation: "El citomegalovirus causa mononucleosis sin anticuerpos heterófilos (test de Paul-Bunnell negativo). El EBV típicamente produce anticuerpos heterófilos positivos, aunque pueden ser negativos en niños pequeños.",
                outdated: false
            },
            {
                id: 12,
                category: "Micología",
                difficulty: "dificil",
                question: "De las siguientes levaduras, ¿cuál produce ureasa?",
                options: [
                    "Candida albicans",
                    "Candida tropicalis",
                    "Candida guilliermondii",
                    "Candida lipolytica"
                ],
                correct: 3,
                explanation: "Candida lipolytica (ahora Yarrowia lipolytica) es ureasa positiva. Esta característica ayuda en su identificación diferencial de otras especies de Candida que suelen ser ureasa negativas.",
                outdated: true,
                updateInfo: {
                    reason: "📋 NOMENCLATURA ACTUALIZADA: Candida lipolytica fue reclasificada en 2003.",
                    currentInfo: "Nomenclatura actual (2024): Nombre anterior Candida lipolytica, nombre actual Yarrowia lipolytica. Sigue siendo ureasa positiva."
                }
            },
            {
                id: 13,
                category: "Parasitología",
                difficulty: "facil",
                question: "Strongyloides stercoralis es un:",
                options: [
                    "Trematodo",
                    "Nematodo",
                    "Cestodo",
                    "Artrópodo"
                ],
                correct: 1,
                explanation: "Strongyloides stercoralis es un nematodo (gusano redondo) que causa estrongiloidiasis. Tiene un ciclo de vida complejo que incluye fases de vida libre y parasitaria, con capacidad de autoinfección.",
                outdated: false
            },
            {
                id: 14,
                category: "Resistencias",
                difficulty: "dificil",
                question: "¿En cuál de los siguientes antibióticos, el cociente Cmax/CMI es el parámetro PK/PD que mejor predice su eficacia?",
                options: [
                    "Vancomicina",
                    "Cefotaxima",
                    "Amikacina",
                    "Linezolid"
                ],
                correct: 2,
                explanation: "Para aminoglucósidos como amikacina, el parámetro PK/PD predictivo de eficacia es Cmax/CMI. Se recomienda una relación Cmax/CMI ≥8-10 para gramnegativos y ≥10-12 para grampositivos.",
                outdated: false
            },
            {
                id: 15,
                category: "Bacteriología",
                difficulty: "medio",
                question: "¿Cuál es el principal factor de riesgo para la adquisición de enfermedad meningocócica?",
                options: [
                    "Hipogammaglobulinemia",
                    "Déficit en varias fracciones del complemento",
                    "Anemia falciforme",
                    "Bajo peso al nacer"
                ],
                correct: 1,
                explanation: "El déficit de complemento, especialmente de las fracciones terminales (C5-C9), es el principal factor de riesgo para infección meningocócica recurrente. También déficit de properdina y factor H.",
                outdated: false
            },
            {
                id: 16,
                category: "Virología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes cuadros clínicos NO está relacionado con Parvovirus B19?",
                options: [
                    "Eritema infeccioso (5ª Enfermedad)",
                    "Endocarditis",
                    "Síndrome guante-calcetín",
                    "Aplasia medular transitoria"
                ],
                correct: 1,
                explanation: "Parvovirus B19 no causa endocarditis. Sí causa eritema infeccioso, síndrome guante-calcetín (exantema papular-purpúrico en manos y pies), y aplasia medular transitoria, especialmente en pacientes con anemia de células falciformes.",
                outdated: false
            },
            {
                id: 17,
                category: "Micología",
                difficulty: "dificil",
                question: "¿De las siguientes especies, cuál corresponde a un hongo dimórfico?",
                options: [
                    "Cryptococcus gatti",
                    "Histoplasma capsulatum",
                    "Talaromyces marneffei",
                    "B y C son correctas"
                ],
                correct: 3,
                explanation: "Tanto Histoplasma capsulatum como Talaromyces marneffei (antes Penicillium marneffei) son hongos dimórficos que crecen como levaduras a 37°C y como moho a temperatura ambiente.",
                outdated: false
            },
            {
                id: 18,
                category: "Parasitología",
                difficulty: "facil",
                question: "¿De cuál de los siguientes fármacos se utiliza en el tratamiento de la teniasis?",
                options: [
                    "Cloroquina",
                    "Praziquantel",
                    "Metronidazol",
                    "Pirimetamina"
                ],
                correct: 1,
                explanation: "Praziquantel es el fármaco de elección para el tratamiento de teniasis (infección por Taenia spp.). Actúa aumentando la permeabilidad de la membrana celular del parásito al calcio.",
                outdated: false
            },
            {
                id: 19,
                category: "Bacteriología",
                difficulty: "medio",
                question: "¿Cuál de las siguientes bacterias produce micelio aéreo?",
                options: [
                    "Rhodococcus equi",
                    "Tsukamurella inchonensis",
                    "Nocardia asteroides",
                    "Gordonia bronchialis"
                ],
                correct: 2,
                explanation: "Nocardia asteroides produce micelio aéreo, una característica morfológica importante de las nocardias. Estas bacterias son actinomicetos filamentosos parcialmente ácido-alcohol resistentes.",
                outdated: false
            },
            {
                id: 20,
                category: "Virología",
                difficulty: "medio",
                question: "¿Por qué es necesario repetir anualmente la vacunación antigripal?",
                options: [
                    "Porque confiere inmunidad poco duradera por ser una vacuna inactivada",
                    "Porque el virus experimenta variación antigénica en sus proteínas de cápsida",
                    "Porque el virus experimenta variación antigénica en sus proteínas de envoltura",
                    "Porque el agente causal varía entre virus A, B o C según el año"
                ],
                correct: 2,
                explanation: "La vacunación anual es necesaria debido a la variación antigénica (deriva antigénica) en las proteínas de superficie del virus influenza: hemaglutinina (H) y neuraminidasa (N).",
                outdated: false
            },
            {
                id: 21,
                category: "Micología",
                difficulty: "medio",
                question: "El fármaco antifúngico con espectro más reducido es:",
                options: [
                    "Anidulafungina",
                    "Fluconazol",
                    "Anfotericina B",
                    "Itraconazol"
                ],
                correct: 1,
                explanation: "Fluconazol tiene el espectro más reducido. No es activo contra hongos filamentosos, C. krusei, C. glabrata (resistencia variable), ni mucorales. Su espectro se limita principalmente a levaduras sensibles.",
                outdated: false
            },
            {
                id: 22,
                category: "Parasitología",
                difficulty: "facil",
                question: "Uno de los siguientes fármacos NO es útil en el tratamiento de la malaria:",
                options: [
                    "Quinina",
                    "Trimetoprim/sulfametoxazol",
                    "Atovacuona/proguanil",
                    "Doxiciclina"
                ],
                correct: 1,
                explanation: "Trimetoprim/sulfametoxazol no se usa en el tratamiento de la malaria. Los otros fármacos sí son útiles: quinina para malaria grave, atovacuona/proguanil para profilaxis y tratamiento, y doxiciclina para profilaxis y tratamiento.",
                outdated: false
            },
            {
                id: 23,
                category: "Bacteriología",
                difficulty: "medio",
                question: "¿Cuál de las siguientes pruebas bioquímicas utilizaría para diferenciar Staphylococcus saprophyticus de Staphylococcus epidermidis?",
                options: [
                    "Catalasa",
                    "DNAsa",
                    "Resistencia a lisostafina",
                    "Resistencia a novobiocina"
                ],
                correct: 3,
                explanation: "S. saprophyticus es resistente a novobiocina mientras que S. epidermidis es sensible. Esta es la prueba clásica para diferenciar ambas especies de estafilococos coagulasa negativos.",
                outdated: false
            },
            {
                id: 24,
                category: "Micología",
                difficulty: "medio",
                question: "¿Cuál de los siguientes antifúngicos sería el más adecuado para tratar una infección por hongos del orden Mucorales?",
                options: [
                    "Caspofungina",
                    "Itraconazol",
                    "Anfotericina B",
                    "Voriconazol"
                ],
                correct: 2,
                explanation: "Anfotericina B es el tratamiento de elección para mucormicosis. Los mucorales son intrínsecamente resistentes a voriconazol y las equinocandinas como caspofungina.",
                outdated: false
            },
            {
                id: 25,
                category: "Resistencias",
                difficulty: "dificil",
                question: "¿Cuál de los siguientes genes de resistencia confiere resistencia a carbapenémicos?",
                options: [
                    "blaTEM",
                    "blaCTX-M",
                    "blaKPC",
                    "blaSHV"
                ],
                correct: 2,
                explanation: "El gen blaKPC codifica la carbapenemasa KPC (Klebsiella pneumoniae carbapenemase) que confiere resistencia a carbapenémicos. Los otros genes codifican beta-lactamasas de espectro extendido.",
                outdated: false
            }
        ];

        // Variables globales
        let currentQuestion = 0;
        let userAnswers = [];
        let showAnswersMode = 'immediate';
        let filteredQuestions = questions;
        let categoryStats = {};
        let startTime = new Date();
        let timerInterval;
        let bookmarkedQuestions = [];
        let quizStarted = false;

        const cheerMessages = [
            "¡Vamos Kike! 🔥 ¡Tú puedes con toda la micro! 💪✨",
            "¡Excelente trabajo! 🌟 ¡Sigue así! 🎯",
            "¡Eres un crack de la microbiología! 🧬⚡",
            "¡Imparable! 🚀 ¡Hacia el éxito! 🏆",
            "¡Cada pregunta te acerca más a la meta! 🎊💫"
        ];

        // Inicializar cuando carga la página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Página cargada correctamente');
            console.log('Preguntas disponibles:', questions.length);
            updateStats();
        });

        // Función para iniciar el quiz
        function startQuiz() {
            console.log('Iniciando quiz...');
            quizStarted = true;
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            
            initializeQuiz();
        }

        // Inicializar estadísticas por categoría
        function initializeCategoryStats() {
            categoryStats = {};
            filteredQuestions.forEach(q => {
                if (!categoryStats[q.category]) {
                    categoryStats[q.category] = {
                        total: 0,
                        correct: 0,
                        answered: 0
                    };
                }
                categoryStats[q.category].total++;
            });
        }

        // Inicializar quiz
        function initializeQuiz() {
            initializeCategoryStats();
            currentQuestion = 0;
            userAnswers = [];
            startTime = new Date();
            startTimer();
            updateStats();
            showQuestion();
            updateCheerMessage();
        }

        // Timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const elapsed = new Date() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Mostrar pregunta actual
        function showQuestion() {
            if (!quizStarted) return;
            
            const container = document.getElementById('quiz-container');
            const question = filteredQuestions[currentQuestion];
            
            const isAnswered = userAnswers[currentQuestion] !== undefined;
            const userAnswer = userAnswers[currentQuestion];
            const isBookmarked = bookmarkedQuestions.includes(question.id);
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">
                            Pregunta ${currentQuestion + 1}
                            ${question.outdated ? '<span class="outdated-badge">⚠️</span>' : ''}
                            <span class="difficulty-badge difficulty-${question.difficulty}">${question.difficulty.toUpperCase()}</span>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                    onclick="toggleBookmark(${question.id})">
                                ${isBookmarked ? '🔖 Marcada' : '📑 Marcar'}
                            </button>
                            <div class="question-category">${question.category}</div>
                        </div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option ${getOptionClass(index, isAnswered, userAnswer, question.correct)}" 
                                 data-index="${index}" onclick="selectAnswer(${index})">
                                <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                                <div>${option}</div>
                            </div>
                        `).join('')}
                    </div>
                    ${(showAnswersMode === 'immediate' || showAnswersMode === 'study') && isAnswered ? `
                        <div class="explanation">
                            <h4>💡 Explicación:</h4>
                            <p><strong>Respuesta correcta:</strong> ${String.fromCharCode(65 + question.correct)}) ${question.options[question.correct]}</p>
                            <p>${question.explanation}</p>
                            ${question.outdated ? `
                                <div class="outdated-warning">
                                    <h4>⚠️ Información Desactualizada</h4>
                                    <div class="update-info">
                                        <p>${question.updateInfo.reason}</p>
                                        <div class="current-info">
                                            <p>${question.updateInfo.currentInfo}</p>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    <div class="navigation">
                        <button class="nav-btn btn-secondary" onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled' : ''}>
                            ← Anterior
                        </button>
                        <div style="display: flex; gap: 10px;">
                            <button class="nav-btn btn-primary" onclick="nextQuestion()">
                                ${currentQuestion === filteredQuestions.length - 1 ? 'Finalizar' : 'Siguiente →'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Marcar/desmarcar pregunta
        function toggleBookmark(questionId) {
            const index = bookmarkedQuestions.indexOf(questionId);
            if (index > -1) {
                bookmarkedQuestions.splice(index, 1);
            } else {
                bookmarkedQuestions.push(questionId);
            }
            showQuestion();
        }

        // Obtener clase CSS para cada opción
        function getOptionClass(index, isAnswered, userAnswer, correctAnswer) {
            if (!isAnswered) {
                return userAnswer === index ? 'selected' : '';
            }
            
            if (showAnswersMode === 'immediate' || showAnswersMode === 'study') {
                if (index === correctAnswer) return 'correct';
                if (index === userAnswer && userAnswer !== correctAnswer) return 'incorrect';
                return '';
            }
            
            return userAnswer === index ? 'selected' : '';
        }

        // Seleccionar respuesta
        function selectAnswer(answerIndex) {
            if (showAnswersMode === 'final' && userAnswers[currentQuestion] !== undefined) {
                return;
            }
            
            userAnswers[currentQuestion] = answerIndex;
            
            // Actualizar estadísticas
            const question = filteredQuestions[currentQuestion];
            const category = question.category;
            
            if (categoryStats[category].answered === 0 || userAnswers[currentQuestion] === answerIndex) {
                categoryStats[category].answered++;
                if (answerIndex === question.correct) {
                    categoryStats[category].correct++;
                }
            }
            
            updateStats();
            showQuestion();
            
            // Cambiar mensaje de la animadora
            if (answerIndex === question.correct) {
                updateCheerMessage(true);
            }
        }

        // Actualizar mensaje de la animadora
        function updateCheerMessage(isCorrect = false) {
            const cheerText = document.getElementById('cheer-text');
            if (isCorrect) {
                cheerText.textContent = cheerMessages[Math.floor(Math.random() * cheerMessages.length)];
            } else {
                cheerText.textContent = cheerMessages[0];
            }
        }

        // Actualizar estadísticas
        function updateStats() {
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('total-questions').textContent = filteredQuestions.length;
            
            const answered = userAnswers.filter(a => a !== undefined).length;
            const correct = userAnswers.filter((a, i) => a === filteredQuestions[i]?.correct).length;
            const incorrect = answered - correct;
            
            document.getElementById('correct-count').textContent = correct;
            document.getElementById('incorrect-count').textContent = incorrect;
            
            // Actualizar barra de progreso
            const progress = (answered / filteredQuestions.length) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        }

        // Navegación
        function nextQuestion() {
            if (currentQuestion < filteredQuestions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Mostrar resultados finales
        function showResults() {
            clearInterval(timerInterval);
            const quizContainer = document.getElementById('quiz-container');
            const resultsContainer = document.getElementById('results-container');
            
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            
            const totalAnswered = userAnswers.filter(a => a !== undefined).length;
            const totalCorrect = userAnswers.filter((a, i) => a === filteredQuestions[i]?.correct).length;
            const percentage = totalAnswered > 0 ? Math.round((totalCorrect / totalAnswered) * 100) : 0;
            
            document.getElementById('final-score').textContent = percentage + '%';
            
            // Mostrar estadísticas por categoría
            const categoryStatsContainer = document.getElementById('category-stats');
            categoryStatsContainer.innerHTML = Object.entries(categoryStats)
                .map(([category, stats]) => {
                    const categoryPercentage = stats.answered > 0 ? Math.round((stats.correct / stats.answered) * 100) : 0;
                    return `
                        <div class="category-stat">
                            <h4>${category}</h4>
                            <p>${stats.correct}/${stats.answered} correctas</p>
                            <div class="category-progress">
                                <div class="category-progress-fill" style="width: ${categoryPercentage}%"></div>
                            </div>
                            <p>${categoryPercentage}% acierto</p>
                        </div>
                    `;
                }).join('');
                
            // Agregar información sobre preguntas desactualizadas
            const outdatedCount = filteredQuestions.filter(q => q.outdated).length;
            if (outdatedCount > 0) {
                categoryStatsContainer.innerHTML += `
                    <div class="category-stat" style="border: 2px solid #ff5722;">
                        <h4>⚠️ Info Desactualizada</h4>
                        <p>${outdatedCount} preguntas incluyen actualizaciones importantes para la práctica clínica actual</p>
                    </div>
                `;
            }

            // Mostrar mensaje de felicitación personalizado
            const finalMessage = percentage >= 80 ? 
                "¡Excelente trabajo Kike! 🏆 Estás súper preparado para las OPE" :
                percentage >= 70 ? 
                "¡Buen trabajo Kike! 💪 Ya tienes una base sólida" :
                "¡Sigue estudiando Kike! 📚 Cada pregunta te hace más fuerte";
                
            categoryStatsContainer.innerHTML += `
                <div class="category-stat" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; grid-column: 1 / -1;">
                    <h4 style="color: white;">${finalMessage}</h4>
                    <p>Tiempo total: ${document.getElementById('timer').textContent}</p>
                    <p>¡Continúa con tu preparación para las OPE!</p>
                </div>
            `;
        }

        // Reiniciar quiz
        function restartQuiz() {
            document.getElementById('results-container').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            quizStarted = false;
            filteredQuestions = questions;
            updateStats();
        }

        // Repasar incorrectas
        function reviewIncorrect() {
            const incorrectQuestions = filteredQuestions.filter((q, i) => 
                userAnswers[i] !== undefined && userAnswers[i] !== q.correct
            );
            if (incorrectQuestions.length > 0) {
                filteredQuestions = incorrectQuestions;
                document.getElementById('results-container').classList.add('hidden');
                document.getElementById('start-screen').classList.remove('hidden');
                quizStarted = false;
                updateStats();
            } else {
                alert('¡Excelente! No tienes preguntas incorrectas para repasar 🎉');
            }
        }

        // Cambiar modo de visualización
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                showAnswersMode = this.dataset.mode;
                if (quizStarted) showQuestion();
            });
        });

        // Filtros por categoría
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const category = this.dataset.category;
                if (category === 'all') {
                    filteredQuestions = questions;
                } else {
                    filteredQuestions = questions.filter(q => q.category === category);
                }
                
                // Si está en medio del quiz, reiniciar
                if (quizStarted) {
                    document.getElementById('quiz-container').classList.add('hidden');
                    document.getElementById('start-screen').classList.remove('hidden');
                    quizStarted = false;
                }
                updateStats();
            });
        });

        // Atajos de teclado
        document.addEventListener('keydown', function(event) {
            if (!quizStarted || event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
            
            switch(event.key) {
                case '1':
                case 'a':
                case 'A':
                    selectAnswer(0);
                    break;
                case '2':
                case 'b':
                case 'B':
                    selectAnswer(1);
                    break;
                case '3':
                case 'c':
                case 'C':
                    selectAnswer(2);
                    break;
                case '4':
                case 'd':
                case 'D':
                    selectAnswer(3);
                    break;
                case 'ArrowLeft':
                    event.preventDefault();
                    previousQuestion();
                    break;
                case 'ArrowRight':
                case ' ':
                    event.preventDefault();
                    nextQuestion();
                    break;
                case 'm':
                case 'M':
                    event.preventDefault();
                    toggleBookmark(filteredQuestions[currentQuestion].id);
                    break;
            }
        });
    </script>
</body>
</html>
